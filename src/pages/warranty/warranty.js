"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const moment = require("moment-mini-ts");
const warranty_service_1 = require("./warranty.service");
const app = getApp();
Page({
    data: {
        loading: true,
        items: []
    },
    async onLoad() {
        await app.ensureLogin();
        wx.showToast({
            title: '数据加载中',
            icon: 'loading',
            duration: 10000
        });
        await warranty_service_1.warrantyService.samplingDatabase();
        let warrantyItems = await warranty_service_1.warrantyService.loadWarrantyItems();
        let viewItems = [];
        warrantyItems.forEach(item => {
            viewItems.push({
                id: item._id,
                plate: item.plate,
                thumbnail: item.thumbnail,
                description: `质保期限： ${moment(item.endDate).format("YYYY-MM-DD")}`,
                approvalStatus: item.approvalStatus
            });
        });
        console.log(warrantyItems);
        wx.hideToast();
        this.setData({
            items: viewItems,
            loading: false
        });
    },
    onShow() {
        console.log(this.route);
    },
    onItemClicked(e) {
        console.log(e);
        let itemId = e.currentTarget.dataset["itemId"];
        wx.navigateTo({
            url: "./detail/detail?id=" + itemId,
        });
    },
    addNew() {
        wx.navigateTo({
            url: './add/add?id=1'
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2FycmFudHkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ3YXJyYW50eS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLHlDQUF5QztBQUN6Qyx5REFBcUU7QUFFckUsTUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFVLENBQUM7QUFpQjdCLElBQUksQ0FBQztJQUNELElBQUksRUFBRTtRQUNGLE9BQU8sRUFBRSxJQUFJO1FBQ2IsS0FBSyxFQUFFLEVBQ047S0FDZ0I7SUFDckIsS0FBSyxDQUFDLE1BQU07UUFDUixNQUFNLEdBQUcsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN4QixFQUFFLENBQUMsU0FBUyxDQUFDO1lBQ1QsS0FBSyxFQUFFLE9BQU87WUFDZCxJQUFJLEVBQUUsU0FBUztZQUNmLFFBQVEsRUFBRSxLQUFLO1NBQ2xCLENBQUMsQ0FBQztRQUNILE1BQU0sa0NBQWUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3pDLElBQUksYUFBYSxHQUFHLE1BQU0sa0NBQWUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBRTlELElBQUksU0FBUyxHQUF1QixFQUFFLENBQUM7UUFDdkMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUN6QixTQUFTLENBQUMsSUFBSSxDQUFDO2dCQUNYLEVBQUUsRUFBRSxJQUFJLENBQUMsR0FBRztnQkFDWixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUs7Z0JBQ2pCLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztnQkFDekIsV0FBVyxFQUFFLFNBQVMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLEVBQUU7Z0JBQ2pFLGNBQWMsRUFBRSxJQUFJLENBQUMsY0FBYzthQUN0QyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQTtRQUNGLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUM7UUFFM0IsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBQ2YsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNULEtBQUssRUFBRSxTQUFTO1lBQ2hCLE9BQU8sRUFBRSxLQUFLO1NBQ2pCLENBQUMsQ0FBQTtJQUVOLENBQUM7SUFFRCxNQUFNO1FBQ0YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUVELGFBQWEsQ0FBQyxDQUFjO1FBQ3hCLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDZixJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvQyxFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1YsR0FBRyxFQUFFLHFCQUFxQixHQUFHLE1BQU07U0FDdEMsQ0FBQyxDQUFBO0lBQ04sQ0FBQztJQUlELE1BQU07UUFDRixFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1YsR0FBRyxFQUFFLGdCQUFnQjtTQUN4QixDQUFDLENBQUE7SUFDTixDQUFDO0NBRUosQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSU15QXBwIH0gZnJvbSBcIi4uLy4uL2FwcFwiO1xyXG5pbXBvcnQgKiBhcyBtb21lbnQgZnJvbSBcIm1vbWVudC1taW5pLXRzXCI7XHJcbmltcG9ydCB7IHdhcnJhbnR5U2VydmljZSwgQXBwcm92YWxTdGF0dXMgfSBmcm9tICcuL3dhcnJhbnR5LnNlcnZpY2UnO1xyXG5cclxuY29uc3QgYXBwID0gZ2V0QXBwPElNeUFwcD4oKTtcclxuXHJcblxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBXYXJyYW50eUxpc3RJdGVtIHtcclxuICAgIGlkOiBzdHJpbmc7XHJcbiAgICBwbGF0ZTogc3RyaW5nO1xyXG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcclxuICAgIHRodW1ibmFpbDogc3RyaW5nO1xyXG4gICAgYXBwcm92YWxTdGF0dXM6IEFwcHJvdmFsU3RhdHVzO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgV2FycmFudHlQYWdlRGF0YSB7XHJcbiAgICBpdGVtczogV2FycmFudHlMaXN0SXRlbVtdLFxyXG4gICAgbG9hZGluZzogYm9vbGVhblxyXG59XHJcblxyXG5QYWdlKHtcclxuICAgIGRhdGE6IHtcclxuICAgICAgICBsb2FkaW5nOiB0cnVlLFxyXG4gICAgICAgIGl0ZW1zOiBbXHJcbiAgICAgICAgXVxyXG4gICAgfSBhcyBXYXJyYW50eVBhZ2VEYXRhLFxyXG4gICAgYXN5bmMgb25Mb2FkKCkge1xyXG4gICAgICAgIGF3YWl0IGFwcC5lbnN1cmVMb2dpbigpO1xyXG4gICAgICAgIHd4LnNob3dUb2FzdCh7XHJcbiAgICAgICAgICAgIHRpdGxlOiAn5pWw5o2u5Yqg6L295LitJyxcclxuICAgICAgICAgICAgaWNvbjogJ2xvYWRpbmcnLFxyXG4gICAgICAgICAgICBkdXJhdGlvbjogMTAwMDBcclxuICAgICAgICB9KTtcclxuICAgICAgICBhd2FpdCB3YXJyYW50eVNlcnZpY2Uuc2FtcGxpbmdEYXRhYmFzZSgpO1xyXG4gICAgICAgIGxldCB3YXJyYW50eUl0ZW1zID0gYXdhaXQgd2FycmFudHlTZXJ2aWNlLmxvYWRXYXJyYW50eUl0ZW1zKCk7XHJcblxyXG4gICAgICAgIGxldCB2aWV3SXRlbXM6IFdhcnJhbnR5TGlzdEl0ZW1bXSA9IFtdO1xyXG4gICAgICAgIHdhcnJhbnR5SXRlbXMuZm9yRWFjaChpdGVtID0+IHtcclxuICAgICAgICAgICAgdmlld0l0ZW1zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgaWQ6IGl0ZW0uX2lkLFxyXG4gICAgICAgICAgICAgICAgcGxhdGU6IGl0ZW0ucGxhdGUsXHJcbiAgICAgICAgICAgICAgICB0aHVtYm5haWw6IGl0ZW0udGh1bWJuYWlsLFxyXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGDotKjkv53mnJ/pmZDvvJogJHttb21lbnQoaXRlbS5lbmREYXRlKS5mb3JtYXQoXCJZWVlZLU1NLUREXCIpfWAsXHJcbiAgICAgICAgICAgICAgICBhcHByb3ZhbFN0YXR1czogaXRlbS5hcHByb3ZhbFN0YXR1c1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIGNvbnNvbGUubG9nKHdhcnJhbnR5SXRlbXMpO1xyXG5cclxuICAgICAgICB3eC5oaWRlVG9hc3QoKTtcclxuICAgICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgICAgICBpdGVtczogdmlld0l0ZW1zLFxyXG4gICAgICAgICAgICBsb2FkaW5nOiBmYWxzZVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgfSxcclxuXHJcbiAgICBvblNob3coKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5yb3V0ZSk7XHJcbiAgICB9LFxyXG5cclxuICAgIG9uSXRlbUNsaWNrZWQoZTogZXZlbnQuVG91Y2gpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlKTtcclxuICAgICAgICBsZXQgaXRlbUlkID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXRbXCJpdGVtSWRcIl07XHJcbiAgICAgICAgd3gubmF2aWdhdGVUbyh7XHJcbiAgICAgICAgICAgIHVybDogXCIuL2RldGFpbC9kZXRhaWw/aWQ9XCIgKyBpdGVtSWQsXHJcbiAgICAgICAgfSlcclxuICAgIH0sXHJcblxyXG5cclxuXHJcbiAgICBhZGROZXcoKSB7XHJcbiAgICAgICAgd3gubmF2aWdhdGVUbyh7XHJcbiAgICAgICAgICAgIHVybDogJy4vYWRkL2FkZD9pZD0xJ1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG59KVxyXG5cclxuIl19